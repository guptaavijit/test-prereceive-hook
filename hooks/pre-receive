#!/bin/bash

# Get the list of added and modified references from standard input
while read oldrev newrev refname; do
  if [[ $refname =~ ^refs/pull/([0-9]+)/head$ ]]; then
    pr_number=${BASH_REMATCH[1]}

    # Get the age of the pull request in seconds
    age=$(expr $(date +%s) - $(git show -s --format=%ct $newrev))

    # Convert the age to minutes
    age_minutes=$(expr $age / 60)

    # Check if the age is greater than 2 minutes
    if [ $age_minutes -gt 2 ]; then
      echo "Error: This pull request is older than 2 minutes and cannot be merged."
      echo "Please open a new pull request with updated changes."
      exit 1
    fi
  fi
done